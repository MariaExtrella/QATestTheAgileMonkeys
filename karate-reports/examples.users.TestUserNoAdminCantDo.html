<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link rel="stylesheet" href="res/bootstrap.min.css" type="text/css"/>
    <link rel="stylesheet" href="res/karate-report.css" type="text/css"/>
    <link rel="shortcut icon" href="favicon.ico"/>
    <script type="text/javascript" src="res/jquery.min.js"></script>
    <script type="text/javascript" src="res/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="res/bootstrap.min.js"></script>
    <script type="text/javascript" src="res/karate-report.js"></script>
    <title>examples.users.TestUserNoAdminCantDo</title>  
  </head>
  <body>   
    <div id="root-container">
      <div id="leftnav">
                
        <div>
  <div class="nav-logo">
    <a href="karate-summary.html">
      <img src="karate-logo.svg" alt="Karate"/>
    </a>
    <div class="nav-count">
      <div id="nav-pass" class="bg-success">1</div>
      <div id="nav-fail" class="bg-danger">0</div>
    </div>
  </div>
  <div id="nav-type">
    <div>Scenarios</div>
  </div>         
  <div id="nav-date">
    <div>2021-05-17 11:00:20 a.Â m.</div>
  </div>        
</div>

        <div class="nav-container">
          <div class="nav-item passed">
            <a href="#[1:10]"><span>[1:10]</span> <span>Querys for an user not admin</span></a>
          </div>
        </div>
      </div>
      <div id="content">
        <div class="page-heading alert alert-primary">
          <a href="karate-summary.html">Summary</a><span class="feature-label">|</span>
          <a href="karate-tags.html">Tags</a><span class="feature-label">|</span>
          <span class="feature-label">Feature:</span>
          <span class="feature-path">examples/users/TestUserNoAdminCantDo.feature</span><span class="feature-label">|</span>
          <span class="feature-name">Test that an user not admin isn&#39;t allowed to do admin functions in the environment set from the java class</span>
          <span class="feature-description"></span>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[1:10]">
            <div class="heading-container">
              <div class="scenario-tags">
                
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[1:10]</span>
                <span class="scenario-name">Querys for an user not admin</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time passed">
              <span>ms:</span>&nbsp;<span>10114</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[1:10]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[1:10]bg"><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Define a function to introduce a sleep in the test</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def wait = function(pause){ java.lang.Thread.sleep(pause) }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.6">11:00:10.278 karate.env system property was: prod 
</div>   

  

</div>
</div>
          <div data-parent="[1:10]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url httpUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Get the idToken for one of the user created by the admin</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.13">
      <div class="step-ref passed">13</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def datas = read(&#39;signinDatasUserNoAdmin.json&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">31</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Call the feature to sign in the API with the JSON file that contains the user&#39;s datas</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.16">
      <div class="step-ref passed">16</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def signIn = call read(&#39;signin.feature&#39;) datas</span>
      </div>
    </div>
    <div class="time-cell passed">905</div>
  </div>

   
  
  

  

     

  <div>
        
    <div class="step-row">
      <div class="step-container" id="0.16.0.call">
        <div class="step-ref passed">&gt;&gt;</div>
        <div class="step-indent"></div>
        <div class="step-cell passed">examples.users.signin</div>
      </div>
      <div class="time-cell passed">882</div>
    </div>
    <div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.4">
      <div class="step-ref passed">4</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url httpUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.7">
      <div class="step-ref passed">7</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def query =</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.16.0.call.0.7">{
  		&quot;clientId&quot;: &quot;#(clientId)&quot;,
        &quot;username&quot;: &quot;#(username)&quot;,
  		&quot;password&quot;: &quot;#(password)&quot;
	}</div>

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.15">
      <div class="step-ref passed">15</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>print query</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.16.0.call.0.15">11:00:10.365 [print] {
  &quot;clientId&quot;: &quot;799hogucm363v55l7dk2n1l5u0&quot;,
  &quot;username&quot;: &quot;user8@test.com&quot;,
  &quot;password&quot;: &quot;Password_1&quot;
}
 
</div>   

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.17">
      <div class="step-ref passed">17</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;/auth/sign-in&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.18">
      <div class="step-ref passed">18</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request query</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.19">
      <div class="step-ref passed">19</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Content-Type = &#39;application/json&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.20">
      <div class="step-ref passed">20</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">867</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.16.0.call.0.20">11:00:10.588 request:
1 &gt; POST https://pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com/test-qa-estrella-prod/auth/sign-in
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Content-Length: 93
1 &gt; Host: pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.13 (Java/16.0.1)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;password&quot;:&quot;Password_1&quot;,&quot;clientId&quot;:&quot;799hogucm363v55l7dk2n1l5u0&quot;,&quot;username&quot;:&quot;user8@test.com&quot;}

11:00:11.235 response time in milliseconds: 633
1 &lt; 200
1 &lt; Content-Type: application/json
1 &lt; Content-Length: 3994
1 &lt; Connection: keep-alive
1 &lt; Date: Mon, 17 May 2021 09:00:11 GMT
1 &lt; x-amzn-RequestId: 5b8c5394-4834-4ba6-8d55-28dcb6797354
1 &lt; Access-Control-Allow-Origin: *
1 &lt; x-amz-apigw-id: fdyISHVJjoEFmfg=
1 &lt; X-Amzn-Trace-Id: Root=1-60a2309b-6a12321f24c1990106d75c0b
1 &lt; X-Cache: Miss from cloudfront
1 &lt; Via: 1.1 8698da0cfd5dac9801848770e0d61b63.cloudfront.net (CloudFront)
1 &lt; X-Amz-Cf-Pop: MAD50-C1
1 &lt; X-Amz-Cf-Id: QzZxAj2TMCOITlW2PG510AaBUoa37wCBBGGWxI3K227ccWMONwbtqA==
{&quot;expiresIn&quot;:&quot;3600&quot;,&quot;idToken&quot;:&quot;eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w&quot;,&quot;accessToken&quot;:&quot;eyJraWQiOiJIcWFQSnUyR1YzN1F5TnBnVlIwSXRHRHJqQ3huZk41aEFvK1ZmZGNtNDBVPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4iLCJhdXRoX3RpbWUiOjE2MjEyNDIwMTEsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC5ldS13ZXN0LTEuYW1hem9uYXdzLmNvbVwvZXUtd2VzdC0xX21IdWVBcjJRdSIsImV4cCI6MTYyMTI0NTYxMSwiaWF0IjoxNjIxMjQyMDExLCJqdGkiOiIwYjliOTM4Yy1hMmMwLTQ3MDAtODYwMy03NmRmYjM5MWI3NDYiLCJjbGllbnRfaWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsInVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIn0.ASJuuWzomb5Lql1ZvheZfwufCKex_Ly341rdIAMqbSOfBa5F_kD5hMz11aPEg3Lip3IoHpOQ5TzjuwrxvfLHX-3UXkCHHuOMy8ZpMapMQoHFCSzfYioG1Zl-2THPV6wrCjF5LmazQ5k3IyjLsVdpNK9O2dWuwEeIkfSJdmop3Fn-k4seRwqvnm4wI6Piy0vOa6q-OiPM6OPgfiksVp99IgBmfgPwMDQrAV_uTJ7ECleWMCio_pPNyQxRimdSkbmpaGO8iHev8MCZ4UDnI802wWEtKYOioP4yQLFtwWjnWU7lwcLpf0c41Peq_lgTgTpCkLZ2TSF0cxbTQMUoR2gepw&quot;,&quot;tokenType&quot;:&quot;Bearer&quot;,&quot;refreshToken&quot;:&quot;eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ.bnX-G5urNPF3RmEs0NSIRGz_ecdkDfuP6akN-hgPPskLfR8BHjbB7DkLOWSqcPz3ND7Gh_7tq9n6k8muoKyohG6HBneHo6cZKGJzoqQAAwk3hXsQULMda456tzsKWCZH9Ez6bcKSYIXKSM4zm_RfFnLbdxXtbTfNSj1H98wZ9dU55ag637rFhDPlOm8PvlEX3WHIzJyLrYIoQJn_tGk-cITwZjzqcZIB7P-pJKtZpU2OigsJ0fIL0Rb0d5z9VS1IKLu1K9gdbaq4b2FeDmLRr5dQrB_pwPuyfi_f5idJ7I4X0xM9QBB4kWrFfHEFFdY9Uu_llP-67UQmxC1JXDSiKw.e4HJUGYF_giu7iB_.ns3Xn19Pyxgvd_hI9AFykm5LcOsg80QCiEU-02G720jaq1iph5rtJNxJGwC9CrutDvlmZ84WbmHKOHbdXb14zzrUfAxf_9HS85LxLfnqul1D9bPL8Tnyy_38tkL2uUUj_sZADzAesM4kzIl6XRAQft4HVP79dHp5ma-zQMa03f7gaKvBV-1zbqGCNgLyUQeFYXb_kp62HYzjKB6FPeQFM4j9lh622qqe3GeVP7BSY5D3SlilXqjBgtzPHNoftGu88bzwC68JUFMKJNqxKizOWKCDj10BvLvtkKK-tFHP8FPQuvbvnrQqG0SIHRtIUwBjZO4JJJ2_owzxARhVkZstbQBwHLZL5fdecpmxFj5N4vdUZbmgm-CReM6ePMkncBqms15FTTqe1jd-_pCIdLDvw2uhjVgm93t5RaGOm_pIZGWKQsgTxwJlnlkGDwEFZtOR9YIKxHDk-2j5HrImqrk3nCqt-t12EdnqMXS0o12c-KqaEc7U39t2cgq68a5kI3_IudnJeUPIwZq01r_tJPWkoUyZO8gZwXYpjattKIbJ__wUM4l2wN-C35gCSWP9gyn-1DDNeepBA8Vq8e5WffqMTlG133VUI_WHi343jHVVbZ-g2rAAcmfkvB7cXG4FIKE1besvIKQE7uE7qm--FIsCfaPUDx4_oYHzMzXrhpjzLYhbcep7T6T7WeClNZ9tZ8kSPS0hA5n8P9Rp5ADiQ0_Y2uw3Y8vUW2-jBKK7EHyJz93OSmEW2CNnlYD40FJ3_G80LWYQsQCTK_gNYRaickM0Bq6bWZZMxD1pMAYvy3MrJyymInVCOOxqjDI-5o1dgd_DB9dzgTtDDxkOka-drwBBBCU7rwN0bbPY1Zhkawg9mmeiQfxbPoCPpyo_yL77yyR8pNukXin9RCdhpbYSnJZozGimCUhGihe-O3PBXFzZChqU1o3HbT4GTE_rwfLZ_HalW0kKkww6UsO9NAcJhhfpBSWZZsNSoUebqc0GdfWKGbEcZY1T6bM9kzMCt-Dyznwwn_MQTF7Oqr0ELqOu8n7RNnje8pgL2BMd4w28OIGMHC2Biou7Jd3fgPsRMSRQYz0Q6DBxKxMPWyBojpdu3SYbjXKGDyz1F_48kwAMdIfzKmfcO8Sxa6MpZ3Gep-3xQoF1irGsiz8LzG8LKMeeIiQpjTeZR5jNCihIzhai3AXAR0PcsfTuwczkiknLVgH9_4mOYmqgoayXngqGLnGL1gZzhRw6pfXcMNDlyLdW5lYdR8s4_9PkMardUq1s88eiAEP3cdUb0ZSL8f3r-00xiqODvPTJRE8qWDNih_rrHszEaqxfV8p0qbtNpPp4tcbzKdk.NxfBmG2-eVercdTbDZLkcw&quot;}
</div>   

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.21">
      <div class="step-ref passed">21</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>Then</span>&nbsp;<span>status 200</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container">
      <div class="step-ref passed"></div>
      <div class="step-indent"></div>
      <div class="step-cell comment">#Get the idToken for the user</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.24">
      <div class="step-ref passed">24</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenid = response.idToken</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.16.0.call">
    <div class="step-container" id="0.16.0.call.0.25">
      <div class="step-ref passed">25</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>print tokenid</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.16.0.call.0.25">11:00:11.240 [print] eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w 
</div>   

  

</div>
</div>
    </div>    
  </div>

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.17">
      <div class="step-ref passed">17</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>print signIn.response</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.17">11:00:11.244 [print] {
  &quot;expiresIn&quot;: &quot;3600&quot;,
  &quot;idToken&quot;: &quot;eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w&quot;,
  &quot;accessToken&quot;: &quot;eyJraWQiOiJIcWFQSnUyR1YzN1F5TnBnVlIwSXRHRHJqQ3huZk41aEFvK1ZmZGNtNDBVPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4iLCJhdXRoX3RpbWUiOjE2MjEyNDIwMTEsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC5ldS13ZXN0LTEuYW1hem9uYXdzLmNvbVwvZXUtd2VzdC0xX21IdWVBcjJRdSIsImV4cCI6MTYyMTI0NTYxMSwiaWF0IjoxNjIxMjQyMDExLCJqdGkiOiIwYjliOTM4Yy1hMmMwLTQ3MDAtODYwMy03NmRmYjM5MWI3NDYiLCJjbGllbnRfaWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsInVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIn0.ASJuuWzomb5Lql1ZvheZfwufCKex_Ly341rdIAMqbSOfBa5F_kD5hMz11aPEg3Lip3IoHpOQ5TzjuwrxvfLHX-3UXkCHHuOMy8ZpMapMQoHFCSzfYioG1Zl-2THPV6wrCjF5LmazQ5k3IyjLsVdpNK9O2dWuwEeIkfSJdmop3Fn-k4seRwqvnm4wI6Piy0vOa6q-OiPM6OPgfiksVp99IgBmfgPwMDQrAV_uTJ7ECleWMCio_pPNyQxRimdSkbmpaGO8iHev8MCZ4UDnI802wWEtKYOioP4yQLFtwWjnWU7lwcLpf0c41Peq_lgTgTpCkLZ2TSF0cxbTQMUoR2gepw&quot;,
  &quot;tokenType&quot;: &quot;Bearer&quot;,
  &quot;refreshToken&quot;: &quot;eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ.bnX-G5urNPF3RmEs0NSIRGz_ecdkDfuP6akN-hgPPskLfR8BHjbB7DkLOWSqcPz3ND7Gh_7tq9n6k8muoKyohG6HBneHo6cZKGJzoqQAAwk3hXsQULMda456tzsKWCZH9Ez6bcKSYIXKSM4zm_RfFnLbdxXtbTfNSj1H98wZ9dU55ag637rFhDPlOm8PvlEX3WHIzJyLrYIoQJn_tGk-cITwZjzqcZIB7P-pJKtZpU2OigsJ0fIL0Rb0d5z9VS1IKLu1K9gdbaq4b2FeDmLRr5dQrB_pwPuyfi_f5idJ7I4X0xM9QBB4kWrFfHEFFdY9Uu_llP-67UQmxC1JXDSiKw.e4HJUGYF_giu7iB_.ns3Xn19Pyxgvd_hI9AFykm5LcOsg80QCiEU-02G720jaq1iph5rtJNxJGwC9CrutDvlmZ84WbmHKOHbdXb14zzrUfAxf_9HS85LxLfnqul1D9bPL8Tnyy_38tkL2uUUj_sZADzAesM4kzIl6XRAQft4HVP79dHp5ma-zQMa03f7gaKvBV-1zbqGCNgLyUQeFYXb_kp62HYzjKB6FPeQFM4j9lh622qqe3GeVP7BSY5D3SlilXqjBgtzPHNoftGu88bzwC68JUFMKJNqxKizOWKCDj10BvLvtkKK-tFHP8FPQuvbvnrQqG0SIHRtIUwBjZO4JJJ2_owzxARhVkZstbQBwHLZL5fdecpmxFj5N4vdUZbmgm-CReM6ePMkncBqms15FTTqe1jd-_pCIdLDvw2uhjVgm93t5RaGOm_pIZGWKQsgTxwJlnlkGDwEFZtOR9YIKxHDk-2j5HrImqrk3nCqt-t12EdnqMXS0o12c-KqaEc7U39t2cgq68a5kI3_IudnJeUPIwZq01r_tJPWkoUyZO8gZwXYpjattKIbJ__wUM4l2wN-C35gCSWP9gyn-1DDNeepBA8Vq8e5WffqMTlG133VUI_WHi343jHVVbZ-g2rAAcmfkvB7cXG4FIKE1besvIKQE7uE7qm--FIsCfaPUDx4_oYHzMzXrhpjzLYhbcep7T6T7WeClNZ9tZ8kSPS0hA5n8P9Rp5ADiQ0_Y2uw3Y8vUW2-jBKK7EHyJz93OSmEW2CNnlYD40FJ3_G80LWYQsQCTK_gNYRaickM0Bq6bWZZMxD1pMAYvy3MrJyymInVCOOxqjDI-5o1dgd_DB9dzgTtDDxkOka-drwBBBCU7rwN0bbPY1Zhkawg9mmeiQfxbPoCPpyo_yL77yyR8pNukXin9RCdhpbYSnJZozGimCUhGihe-O3PBXFzZChqU1o3HbT4GTE_rwfLZ_HalW0kKkww6UsO9NAcJhhfpBSWZZsNSoUebqc0GdfWKGbEcZY1T6bM9kzMCt-Dyznwwn_MQTF7Oqr0ELqOu8n7RNnje8pgL2BMd4w28OIGMHC2Biou7Jd3fgPsRMSRQYz0Q6DBxKxMPWyBojpdu3SYbjXKGDyz1F_48kwAMdIfzKmfcO8Sxa6MpZ3Gep-3xQoF1irGsiz8LzG8LKMeeIiQpjTeZR5jNCihIzhai3AXAR0PcsfTuwczkiknLVgH9_4mOYmqgoayXngqGLnGL1gZzhRw6pfXcMNDlyLdW5lYdR8s4_9PkMardUq1s88eiAEP3cdUb0ZSL8f3r-00xiqODvPTJRE8qWDNih_rrHszEaqxfV8p0qbtNpPp4tcbzKdk.NxfBmG2-eVercdTbDZLkcw&quot;
}
 
</div>   

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Create the Authorization header</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.20">
      <div class="step-ref passed">20</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def idToken = signIn.response.idToken</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.21">
      <div class="step-ref passed">21</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def user_header = &quot;Bearer &quot; + idToken</span>
      </div>
    </div>
    <div class="time-cell passed">10</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.22">
      <div class="step-ref passed">22</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>print user_header</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.22">11:00:11.256 [print] Bearer eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w 
</div>   

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># List all the users. Only an admin user can, so the test shouldn&#39;t retrun datas</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Get the query from a .feature field</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.28">
      <div class="step-ref passed">28</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def query =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.28">read(&#39;UserReadModels.graphql&#39;)</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.33">
      <div class="step-ref passed">33</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;graphql&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.34">
      <div class="step-ref passed">34</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Authorization = signIn.response.tokenType + &#39; &#39; + signIn.response.idToken</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.35">
      <div class="step-ref passed">35</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Content-Type = &#39;application/json&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.36">
      <div class="step-ref passed">36</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request { query: &#39;#(query)&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.37">
      <div class="step-ref passed">37</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">256</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.37">11:00:11.265 request:
1 &gt; POST https://pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com/test-qa-estrella-prod/graphql
1 &gt; Authorization: Bearer eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Content-Length: 102
1 &gt; Host: pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.13 (Java/16.0.1)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;query&quot;:&quot;query UserReadModels {\r\n    UserReadModels {\r\n        id\r\n        role\r\n    }\r\n}&quot;}

11:00:11.516 response time in milliseconds: 250
1 &lt; 200
1 &lt; Content-Type: application/json
1 &lt; Content-Length: 162
1 &lt; Connection: keep-alive
1 &lt; Date: Mon, 17 May 2021 09:00:11 GMT
1 &lt; x-amzn-RequestId: 2e1a23f5-6146-4faf-a429-422d13561c72
1 &lt; Access-Control-Allow-Origin: *
1 &lt; x-amz-apigw-id: fdyIXGeYjoEFfLw=
1 &lt; X-Amzn-Trace-Id: Root=1-60a2309b-11a3bbc92c8438ba0cb84311;Sampled=0
1 &lt; X-Cache: Miss from cloudfront
1 &lt; Via: 1.1 17a71b4bf5d35b398b0fd90a5cd154a7.cloudfront.net (CloudFront)
1 &lt; X-Amz-Cf-Pop: MAD50-C1
1 &lt; X-Amz-Cf-Id: ARRpkOU98JDkyLv4JRMUQWyR6Io-PGPW7jZVI3uMc2HVDfigRwtjAA==
{&quot;data&quot;:{&quot;UserReadModels&quot;:null},&quot;errors&quot;:[{&quot;path&quot;:[&quot;UserReadModels&quot;],&quot;locations&quot;:[{&quot;line&quot;:2,&quot;column&quot;:5}],&quot;message&quot;:&quot;Access denied for read model UserReadModel&quot;}]}
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.38">
      <div class="step-ref passed">38</div>
      
      <div class="step-cell passed">
        <span>Then</span>&nbsp;<span>status 200</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># if the response status is not 200, the test finish</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.41">
      <div class="step-ref passed">41</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>if (responseStatus != 200) karate.abort()</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># As the user is not admin, the response contains a field &quot;error&quot; and it is printed</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.44">
      <div class="step-ref passed">44</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match response.errors != &#39;#notpresent&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">8</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment">#The user not admin can&#39;t create a new user</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.49">
      <div class="step-ref passed">49</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def query =</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.49">read(&#39;SaveUser.graphql&#39;)</div>

  

  <div class="preformatted" data-parent="0.49">11:00:11.534 over-writing existing variable &#39;query&#39; with new value: read(&#39;SaveUser.graphql&#39;)
</div>   

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># JSON file with the new user&#39;s datas</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.54">
      <div class="step-ref passed">54</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def user_datas = read(&#39;NewUser.json&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.56">
      <div class="step-ref passed">56</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;graphql&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.57">
      <div class="step-ref passed">57</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Authorization = signIn.response.tokenType + &#39; &#39; + signIn.response.idToken</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.58">
      <div class="step-ref passed">58</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request { query: &#39;#(query)&#39;,  variables: &#39;#(user_datas)&#39;}</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.59">
      <div class="step-ref passed">59</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">118</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.59">11:00:11.539 request:
2 &gt; POST https://pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com/test-qa-estrella-prod/graphql
2 &gt; Authorization: Bearer eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w
2 &gt; Content-Type: application/json; charset=UTF-8
2 &gt; Content-Length: 249
2 &gt; Host: pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com
2 &gt; Connection: Keep-Alive
2 &gt; User-Agent: Apache-HttpClient/4.5.13 (Java/16.0.1)
2 &gt; Accept-Encoding: gzip,deflate
{&quot;variables&quot;:{&quot;password&quot;:&quot;Password1&quot;,&quot;role&quot;:&quot;User&quot;,&quot;username&quot;:&quot;user9@test.com&quot;},&quot;query&quot;:&quot;mutation SaveUser($username: String, $password: String, $role: String) {\r\n    SaveUser(input: {username: $username, password: $password, role: $role})\r\n} &quot;}

11:00:11.655 response time in milliseconds: 115
2 &lt; 200
2 &lt; Content-Type: application/json
2 &lt; Content-Length: 144
2 &lt; Connection: keep-alive
2 &lt; Date: Mon, 17 May 2021 09:00:12 GMT
2 &lt; x-amzn-RequestId: 7a295217-26cc-4d7c-8aad-fa00a5edb1ff
2 &lt; Access-Control-Allow-Origin: *
2 &lt; x-amz-apigw-id: fdyIaEuRjoEFeNw=
2 &lt; X-Amzn-Trace-Id: Root=1-60a2309c-36b84abc7f1307686574784e;Sampled=0
2 &lt; X-Cache: Miss from cloudfront
2 &lt; Via: 1.1 713e5c81a0f7ad564b97cf451e92aaac.cloudfront.net (CloudFront)
2 &lt; X-Amz-Cf-Pop: MAD50-C1
2 &lt; X-Amz-Cf-Id: IsNvPsBC7IPOKdawWIkjm_C5fIcdL60PUIms9sUzXHKaRCRncdNclg==
{&quot;data&quot;:{&quot;SaveUser&quot;:null},&quot;errors&quot;:[{&quot;path&quot;:[&quot;SaveUser&quot;],&quot;locations&quot;:[{&quot;line&quot;:2,&quot;column&quot;:5}],&quot;message&quot;:&quot;Access denied for command &#39;SaveUser&#39;&quot;}]}
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.60">
      <div class="step-ref passed">60</div>
      
      <div class="step-cell passed">
        <span>Then</span>&nbsp;<span>status 200</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Introduce a pause so the user can be saved before the next test</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.63">
      <div class="step-ref passed">63</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>wait(4000)</span>
      </div>
    </div>
    <div class="time-cell passed">4019</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># if the response status is not 200, the test finish</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.66">
      <div class="step-ref passed">66</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>if (responseStatus != 200) karate.abort()</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># As the user is not admin, the response must contains a field &quot;error&quot;</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.69">
      <div class="step-ref passed">69</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match response.errors != &#39;#notpresent&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># The user can&#39;t list a user by id</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Get the query from a .graphql file</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.75">
      <div class="step-ref passed">75</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def query =</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.75">read(&#39;UserReadModel.graphql&#39;)</div>

  

  <div class="preformatted" data-parent="0.75">11:00:15.678 over-writing existing variable &#39;query&#39; with new value: read(&#39;UserReadModel.graphql&#39;)
</div>   

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Define the username of the user to list</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.81">
      <div class="step-ref passed">81</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def newUser = read(&#39;NewUser.json&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.82">
      <div class="step-ref passed">82</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def id =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.82">{ 
   &quot;id&quot;: &quot;#(newUser.username)&quot;
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.88">
      <div class="step-ref passed">88</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>print id</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.88">11:00:15.682 [print] {
  &quot;id&quot;: &quot;user9@test.com&quot;
}
 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.90">
      <div class="step-ref passed">90</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;graphql&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.92">
      <div class="step-ref passed">92</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Authorization = signIn.response.tokenType + &#39; &#39; + signIn.response.idToken</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.93">
      <div class="step-ref passed">93</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Content-Type = &#39;application/json&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.94">
      <div class="step-ref passed">94</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request { query: &#39;#(query)&#39;, variables: &#39;#(id)&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.95">
      <div class="step-ref passed">95</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">238</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.95">11:00:15.684 request:
3 &gt; POST https://pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com/test-qa-estrella-prod/graphql
3 &gt; Authorization: Bearer eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w
3 &gt; Content-Type: application/json; charset=UTF-8
3 &gt; Content-Length: 155
3 &gt; Host: pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com
3 &gt; Connection: Keep-Alive
3 &gt; User-Agent: Apache-HttpClient/4.5.13 (Java/16.0.1)
3 &gt; Accept-Encoding: gzip,deflate
{&quot;variables&quot;:{&quot;id&quot;:&quot;user9@test.com&quot;},&quot;query&quot;:&quot;query UserReadModel($id: ID!) {\r\n    UserReadModel(id: $id) {\r\n        id\r\n        role\r\n    }\r\n}&quot;}

11:00:15.919 response time in milliseconds: 234
3 &lt; 200
3 &lt; Content-Type: application/json
3 &lt; Content-Length: 160
3 &lt; Connection: keep-alive
3 &lt; Date: Mon, 17 May 2021 09:00:16 GMT
3 &lt; x-amzn-RequestId: 10e02ae0-1ad6-420a-ba8d-cafde1a559db
3 &lt; Access-Control-Allow-Origin: *
3 &lt; x-amz-apigw-id: fdyJEECqjoEF8qQ=
3 &lt; X-Amzn-Trace-Id: Root=1-60a230a0-59740fc967457b7f0314de99;Sampled=0
3 &lt; X-Cache: Miss from cloudfront
3 &lt; Via: 1.1 315f537a0be356b37267f2ae21a5363d.cloudfront.net (CloudFront)
3 &lt; X-Amz-Cf-Pop: MAD50-C1
3 &lt; X-Amz-Cf-Id: NveCcf2O9bgHod_KdRQLVXkf4f7K2-1DGeJ9EBGO8tYE6y96ETMgJw==
{&quot;data&quot;:{&quot;UserReadModel&quot;:null},&quot;errors&quot;:[{&quot;path&quot;:[&quot;UserReadModel&quot;],&quot;locations&quot;:[{&quot;line&quot;:2,&quot;column&quot;:5}],&quot;message&quot;:&quot;Access denied for read model UserReadModel&quot;}]}
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.96">
      <div class="step-ref passed">96</div>
      
      <div class="step-cell passed">
        <span>Then</span>&nbsp;<span>status 200</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># As the user is not admin, the response of the query shouldn&#39;t contain the datas of the user tryed to saved</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.99">
      <div class="step-ref passed">99</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match response.data.UserReadModel != {id: &#39;#(newUser.username)&#39;, role: &#39;#(newUser.role)&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># An user no admin can&#39;t change the role of other user</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.104">
      <div class="step-ref passed">104</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def query =</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.104">read(&#39;ChangeUserRole.graphql&#39;)</div>

  

  <div class="preformatted" data-parent="0.104">11:00:15.923 over-writing existing variable &#39;query&#39; with new value: read(&#39;ChangeUserRole.graphql&#39;)
</div>   

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># JSON file with the new user role</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.109">
      <div class="step-ref passed">109</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def user_datas_change = read(&#39;UserRole.json&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref passed">111</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;graphql&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.112">
      <div class="step-ref passed">112</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Authorization = signIn.response.tokenType + &#39; &#39; + signIn.response.idToken</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.113">
      <div class="step-ref passed">113</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request { query: &#39;#(query)&#39;,  variables: &#39;#(user_datas)&#39;}</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.114">
      <div class="step-ref passed">114</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">235</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.114">11:00:15.929 request:
4 &gt; POST https://pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com/test-qa-estrella-prod/graphql
4 &gt; Authorization: Bearer eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w
4 &gt; Content-Type: application/json; charset=UTF-8
4 &gt; Content-Length: 218
4 &gt; Host: pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com
4 &gt; Connection: Keep-Alive
4 &gt; User-Agent: Apache-HttpClient/4.5.13 (Java/16.0.1)
4 &gt; Accept-Encoding: gzip,deflate
{&quot;variables&quot;:{&quot;password&quot;:&quot;Password1&quot;,&quot;role&quot;:&quot;User&quot;,&quot;username&quot;:&quot;user9@test.com&quot;},&quot;query&quot;:&quot;mutation ChangeUserRole($username: String, $role: String) {\r\n  ChangeUserRole(input: {username: $username, role: $role})\r\n}&quot;}

11:00:16.161 response time in milliseconds: 231
4 &lt; 200
4 &lt; Content-Type: application/json
4 &lt; Content-Length: 162
4 &lt; Connection: keep-alive
4 &lt; Date: Mon, 17 May 2021 09:00:16 GMT
4 &lt; x-amzn-RequestId: 237e08e4-a92d-46ce-bb89-cb648b718ac0
4 &lt; Access-Control-Allow-Origin: *
4 &lt; x-amz-apigw-id: fdyJGE7UDoEFX4Q=
4 &lt; X-Amzn-Trace-Id: Root=1-60a230a0-535544be261ebcd41af869cb;Sampled=0
4 &lt; X-Cache: Miss from cloudfront
4 &lt; Via: 1.1 d8c266ed74a4ecc05eeffe79fa473f7e.cloudfront.net (CloudFront)
4 &lt; X-Amz-Cf-Pop: MAD50-C1
4 &lt; X-Amz-Cf-Id: J-DUSWhKWAnhiB52_07F3n2KwuptdF9mrk3EhP1s83w5LZYbSoEALA==
{&quot;data&quot;:{&quot;ChangeUserRole&quot;:null},&quot;errors&quot;:[{&quot;path&quot;:[&quot;ChangeUserRole&quot;],&quot;locations&quot;:[{&quot;line&quot;:2,&quot;column&quot;:3}],&quot;message&quot;:&quot;Access denied for command &#39;ChangeUserRole&#39;&quot;}]}
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.115">
      <div class="step-ref passed">115</div>
      
      <div class="step-cell passed">
        <span>Then</span>&nbsp;<span>status 200</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Introduce a pause so the user can be saved before the next test</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.118">
      <div class="step-ref passed">118</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>wait(4000)</span>
      </div>
    </div>
    <div class="time-cell passed">4006</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># if the response status is not 200, the test finish</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.121">
      <div class="step-ref passed">121</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>if (responseStatus != 200) karate.abort()</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># As the user is not admin, the response must contain a field &quot;error&quot;</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.124">
      <div class="step-ref passed">124</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match response.errors != &#39;#notpresent&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># The user can&#39;t delete other users</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Get the query from a .graphql file</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.131">
      <div class="step-ref passed">131</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def query =</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.131">read(&#39;DeleteUser.graphql&#39;)</div>

  

  <div class="preformatted" data-parent="0.131">11:00:20.170 over-writing existing variable &#39;query&#39; with new value: read(&#39;DeleteUser.graphql&#39;)
</div>   

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># Define the username of the user to list</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.137">
      <div class="step-ref passed">137</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def newUser = read(&#39;UserToDelete.json&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.137">11:00:20.173 over-writing existing variable &#39;newUser&#39; with new value: read(&#39;UserToDelete.json&#39;)
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.138">
      <div class="step-ref passed">138</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def id =</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.138">{ 
   &quot;id&quot;: &quot;#(UserToDelete.username)&quot;
}</div>

  

  <div class="preformatted" data-parent="0.138">11:00:20.174 over-writing existing variable &#39;id&#39; with new value: { 
   &quot;id&quot;: &quot;#(UserToDelete.username)&quot;
}
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.144">
      <div class="step-ref passed">144</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>print id</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.144">11:00:20.179 [print] {
  &quot;id&quot;: &quot;#(UserToDelete.username)&quot;
}
 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.146">
      <div class="step-ref passed">146</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;graphql&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.148">
      <div class="step-ref passed">148</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Authorization = signIn.response.tokenType + &#39; &#39; + signIn.response.idToken</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.149">
      <div class="step-ref passed">149</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Content-Type = &#39;application/json&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.150">
      <div class="step-ref passed">150</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request { query: &#39;#(query)&#39;, variables: &#39;#(id)&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref passed">151</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">245</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.151">11:00:20.182 request:
5 &gt; POST https://pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com/test-qa-estrella-prod/graphql
5 &gt; Authorization: Bearer eyJraWQiOiJHa3NQT29DVkd3b2NMV0ROZ0tvNVE0R3ViRFNUV0xNeDhHYVJmSFZcL0U3QT0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIyYWQ2MWM2Yi02OTNjLTQ3OTgtYjJjZS01NGRiOWFiMDdhMGEiLCJhdWQiOiI3OTlob2d1Y20zNjN2NTVsN2RrMm4xbDV1MCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJldmVudF9pZCI6IjhkOGVkYmE5LTUwOGItNDI1MC04ZTQyLTFjNjc5NWYzMjg3NCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjIxMjQyMDExLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuZXUtd2VzdC0xLmFtYXpvbmF3cy5jb21cL2V1LXdlc3QtMV9tSHVlQXIyUXUiLCJjb2duaXRvOnVzZXJuYW1lIjoiMmFkNjFjNmItNjkzYy00Nzk4LWIyY2UtNTRkYjlhYjA3YTBhIiwiZXhwIjoxNjIxMjQ1NjExLCJjdXN0b206cm9sZSI6InVzZXIiLCJpYXQiOjE2MjEyNDIwMTEsImVtYWlsIjoidXNlcjhAdGVzdC5jb20ifQ.g5Ws7HrWclOJS8DOAoI0bctqBEhsClbv5r1oBNDjGS-_qu_FzcOnU14ZuczK8A33VFcMpVP0SnBIaj40cor7P1Z2Nio80BTyoFWU6nKyZvQnz_vFYn3CzkJKfn_uq5h24nHZGwoP6Rsv-NPv2GOKhTif7mgn6bks6BVfpj8PPsH_v4MVvIPPnSyMKwk45SkUwuG4qojKKFdvlF4CKCdj9sMNklhhxf8aUadQnGu778EJFX2FeXBKZXHSOGoxVSpILs-4Zfk3r8cyWr9YX7uZXrSVKdFzN-FpRDj9IK0v-FHpyUCmf-tEUoA0TX1hTcwd08x5x2HJ7k7_vhdYDli-9w
5 &gt; Content-Type: application/json; charset=UTF-8
5 &gt; Content-Length: 156
5 &gt; Host: pnbbxqm2y9.execute-api.eu-west-1.amazonaws.com
5 &gt; Connection: Keep-Alive
5 &gt; User-Agent: Apache-HttpClient/4.5.13 (Java/16.0.1)
5 &gt; Accept-Encoding: gzip,deflate
{&quot;variables&quot;:{&quot;id&quot;:&quot;#(UserToDelete.username)&quot;},&quot;query&quot;:&quot;mutation DeleteUser($username: String) {\r\n    DeleteUser(input: {username: $username})\r\n} \r\n&quot;}

11:00:20.425 response time in milliseconds: 242
5 &lt; 200
5 &lt; Content-Type: application/json
5 &lt; Content-Length: 150
5 &lt; Connection: keep-alive
5 &lt; Date: Mon, 17 May 2021 09:00:20 GMT
5 &lt; x-amzn-RequestId: 4b58d9f5-c09f-44b8-8cac-b38d2e66528b
5 &lt; Access-Control-Allow-Origin: *
5 &lt; x-amz-apigw-id: fdyJxGlCDoEFewg=
5 &lt; X-Amzn-Trace-Id: Root=1-60a230a4-0bfe68d730fd96bc16d9fd22;Sampled=0
5 &lt; X-Cache: Miss from cloudfront
5 &lt; Via: 1.1 eb28dde7b66308b26496e3a543c93412.cloudfront.net (CloudFront)
5 &lt; X-Amz-Cf-Pop: MAD50-C1
5 &lt; X-Amz-Cf-Id: nVTROENM9FQn3JozujXcO1DYJ2osOmK7BpwMTCIIRsHuyLoK91QpOg==
{&quot;data&quot;:{&quot;DeleteUser&quot;:null},&quot;errors&quot;:[{&quot;path&quot;:[&quot;DeleteUser&quot;],&quot;locations&quot;:[{&quot;line&quot;:2,&quot;column&quot;:5}],&quot;message&quot;:&quot;Access denied for command &#39;DeleteUser&#39;&quot;}]}
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.152">
      <div class="step-ref passed">152</div>
      
      <div class="step-cell passed">
        <span>Then</span>&nbsp;<span>status 200</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  <div class="step-row">
    <div class="step-container">
      <div class="step-ref passed"></div>
      
      <div class="step-cell comment"># As the user is not admin, the response of the query shouldn&#39;t contain the datas of the user tryed to saved</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row">
    <div class="step-container" id="0.155">
      <div class="step-ref passed">155</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match response.errors != &#39;#notpresent&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
      </div>
    </div>
  </body>
</html>

